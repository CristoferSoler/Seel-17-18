{% extends "admin/index.html" %}
{% block branding %}
            <h1 id="site-name"><a href="">Administration Control Panel</a></h1>
{% endblock %}

{% block sidebar %}

	<div class="module">
        <table>
        <caption>
            <a href="#" class="section" title="Update the BSI version">BSI Update</a>
        </caption>

            <tr class="model-image">
				<th>Update</th>
				<td scope="row"><button id="update_btn" onclick="startUpdate()">Start</button></td>
            </tr>

            <tr class="model-image">
				<th><p id="update"></p></th>
            </tr>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
	$(document).ready(function () {
        var id =  $("#update")
        var data = {};
        $.ajax({
            dataType:'json',
            url:'/_update/check_update/',
            data: data,

            success: function(data) {
            if(data.status == true){
                $("#update_btn").prop('disabled', true); // disable button
                id.text(data.msg);
            }else {
                $("#update_btn").prop('disabled', false); // enable button
                id.text("No running update")
            }
            },
        });
    });

	function startUpdate() {
	    var id =  $("#update")
		var data = {};
		$.ajax({
            dataType:'json',
            url:'/_update/update/',
            data: data,

            beforeSend: function(data) {
                  $("#update_btn").prop('disabled', true); // disable button
                  id.text('Starting update...')
            },

            success: function(data) {
            if(data.status == 'ok'){
              $("#update_btn").prop('disabled', false);
              id.text(data.msg);
            } else if(data.status == 'error'){
                $("#update_btn").prop('disabled', false); // disable button
                id.text(data.msg);
                }
               },
        });
    }

</script>

{% endblock %}