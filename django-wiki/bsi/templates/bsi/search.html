{% extends 'bsi/base.html' %} {% load wiki_tags i18n humanize %}
{% block wiki_pagetitle %}{% trans "Search results for:"
    %} {{ search_query }}{% endblock %} {% block bsi_contents %}
    <div class="container margin-after-nav">
        <h1 class="page-header">
            {% trans "Search results for:" %} {{ search_query }}
        </h1>
        <div class="form-group">
            <p class="lead">
            <form id="wiki-search-form-big" method="GET" action="{% url 'bsisearch' %}">
                <div class="form-group">
                    <div class="input-group">
                        <input type="search" class="form-control search-query" name="q" value="{{ search_query }}"/>
                        <div class="input-group-btn bs-dropdown-to-select-group">
                            <button type="button" class="btn btn-default dropdown-toggle as-is bs-dropdown-to-select"
                                    data-toggle="dropdown">
                                <span data-bind="bs-drp-sel-label">All</span>
                                <input type="hidden" name="selected_value" data-bind="bs-drp-sel-value" value="">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" role="menu" style="">
                                <li data-value="1"><a href="#">All</a></li>
                                <li data-value="C"><a href="#}">componenets</a></li>
                                <li data-value="G"><a href="#">Threats</a></li>
                                <li data-value="N"><a href="#">implementation Notes</a></li>
                                <li data-value="5"><a href="#">Archive</a></li>
                            </ul>
                        </div>
                    </div>

                </div>
            </form>



            <form method="GET">
                <select id="airline-selected">
                    <option value="C">Components</option>
                    <option value="G">Threatss</option>
                    <option value="N">Implementation Notes</option>
                </select>
                <input type="button" value="Update" id="selection-button" method="GET">
            </form>





            {% blocktrans with paginator.object_list.count as cnt %}Your search returned
                <strong>{{ cnt }}</strong> results.{% endblocktrans %}</p>
            <div class="clearfix"></div>
            </p>
        </div>

        <table class="table table-striped">
            <tr>
                <th style="width: 55%">Title</th>
                <!-- trans -->
                <th>Category</th>
                <th>Last modified</th>

            </tr>
            {% for article in articles %} {% block wiki_search_loop %}

                {% for urlpath in article.urlpath_set.all %}
                    <tr>
                        <td>
                            <a href="{% url 'get_article' path=urlpath.path %}">{{ article.current_revision.title }}

                                <br/>
                                <small class="muted">/{{ urlpath.path }}</small>
                            </a>

                            {% if article.current_revision.deleted %}
                                <span class="fa fa-trash"></span>
                            {% endif %} {% if article.current_revision.locked %}
                            <span class="fa fa-lock"></span>
                        {% endif %}
                            {% if urlpath %}
                                <p class="muted">
                                    <small>{{ article.render|get_content_snippet:search_query }}</small>
                                </p>
                            {% endif %}
                        </td>

                        <td>
                            {{urlpath.bsi.articleType}}
                        </td>
                        <td style="white-space: nowrap">
                            {{ article.current_revision.created|naturaltime }}
                        </td>
                    </tr>
                {% endfor %}



            {% endblock %} {% empty %}
                <tr>
                    <td colspan="100">
                        <em>There are no articles in this level</em>
                    </td>
                </tr>
            {% endfor %}
        </table>

    </div>

    <script>

        $( "#selection-button" ).click(function(event) {
            event.preventDefault();
            debugger
            var airlineSelected = $('#airline-selected').find(":selected").val();

            $.ajax({
     url: "{% url 'bsifilter' %}",
     method: 'GET',
     data : {
             filter_category: airlineSelected
     },
     success: function(data){
         console.log(data)
     },
     error: function(xhr, errmsg, err){
         console.log("error")
         console.log(err)
     }
});
        })


        $(document).ready(function (e) {
            $(document).on('click', '.bs-dropdown-to-select-group .dropdown-menu li', function (event) {
                var $target = $(event.currentTarget);
                $target.closest('.bs-dropdown-to-select-group')
                    .find('[data-bind="bs-drp-sel-value"]').val($target.attr('data-value'))
                    .end()
                    .children('.dropdown-toggle').dropdown('toggle');
                $target.closest('.bs-dropdown-to-select-group')
                    .find('[data-bind="bs-drp-sel-label"]').text($target.context.textContent);
                return false;
            });
        });
    </script> {% endblock %}
