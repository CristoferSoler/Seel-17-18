#M 4.338 Use of file and registry virtualization for clients as of Windows Vista
Responsible for initiation: Head of IT

Responsible for implementation: administrator, IT security officer, IT manager

Old legacy applications, legacy applications, are applications that were originally developed for older versions of Windows, but now also run under a current version of Windows, such as Windows Vista, Windows 7, and Windows 8 should be. Often legacy applications that have been developed for standard users have a certain security weakness: Legacy applications require write access to critical file folders or registry keys. Critical file folders include, for example, the% ProgramFiles% folders (in a standard C: / Program install) or% SystemRoot% (in a default installation). A critical registry area is HKLM / Software. Write operations to these critical areas require administrative privileges. As a result, the default user must log in with an administrator account to use an legacy application of the type described. This threatens the integrity of the Windows system by possible malicious programs that run with the privileges of the logged on account, here an administrator account.

Windows versions from Windows Vista use File Virtualization and Registry Virtualization techniques for secure legacy use. The associated mechanisms allow the legacy application to operate under the account of a standard user, that is, without administrative privileges. This prevents the described vulnerability of the integrity of the actual, non-virtualized Windows system. For File Virtualization and Registry Virtualization, Windows versions starting with Windows Vista redirect all write accesses and, if necessary, read accesses to an application that targets critical directory or registry areas to which the application is not authorized. This redirection takes place in special areas, which apply only to the registered user. For operations in directories, the redirected access is made to the area% UserProfile% / AppData / Local / VirtualStore, for operations in registry areas the redirection to HKEY_CURRENT_USER / Software / Classes / VirtualStore takes place. Damage to the integrity of these areas does not compromise the integrity of the Windows system itself, but the integrity of the virtualized system visible to the user remains unsupported.

In principle, legacy applications for standard users running only with administrative privileges prior to Windows Vista should not be used. However, the operation of such an old application may be indispensable for completing a task in a specialized procedure or business process. In such cases, the operation of the legacy application may be considered after mitigating the security risks as of Windows Vista.

In the Windows client versions as of Windows Vista, the command line tool reg.exe contains an extension with the FLAGS command. This allows an administrator for registry keys below / HKLM / Software to control whether or not to support registry virtualization.

It should be critically examined whether the operation of legacy applications of the type described is necessary. It's a good idea to minimize the amount of registry keys that should support registry virtualization to meet the needs of legacy applications.

In the long term it has to be considered to replace the legacy applications of the described type of hazard with safe applications. Secure applications, as a standard user application, do not require write operations to critical directory and / or registry areas. It is also recommended switching to secure applications because Microsoft considers the techniques of file virtualization and registry virtualization only as transition solutions for previously unsafe legacy applications. A limitation of file and registry virtualization is that it does not support 64-bit applications and does not work when running an application with administration rights.



